{"version":3,"file":"markdownItAnchor.mjs","sources":["../index.js"],"sourcesContent":["const slugify = (s) => encodeURIComponent(String(s).trim().toLowerCase().replace(/\\s+/g, '-'))\n\nconst position = {\n  false: 'push',\n  true: 'unshift'\n}\n\nconst hasProp = Object.prototype.hasOwnProperty\n\nconst permalinkHref = slug => `#${slug}`\n\nconst createLink = (state, className, href, content) => {\n  return [\n    Object.assign(new state.Token('link_open', 'a', 1), {\n      attrs: [\n        ['class', className],\n        ['href', href],\n        ['aria-hidden', 'true']\n      ]\n    }),\n    Object.assign(new state.Token('html_block', '', 0), { content }),\n    new state.Token('link_close', 'a', -1)\n  ]\n}\n\nconst addLink = (state, withSpace, before, idx, linkTokens) => {\n  const space = () => Object.assign(new state.Token('text', '', 0), { content: ' ' })\n\n  // `push` or `unshift` according to position option.\n  // Space is at the opposite side.\n  if (withSpace) {\n    linkTokens[position[!before]](space())\n  }\n\n  state.tokens[idx + 1].children[position[before]](...linkTokens)\n}\n\nconst renderPermalink = (slug, opts, state, idx) => {\n  const linkTokens = createLink(state, opts.permalinkClass,\n    opts.permalinkHref(slug, state), opts.permalinkSymbol)\n\n  addLink(state, opts.permalinkSpace, opts.permalinkBefore, idx, linkTokens)\n}\n\nconst renderToplink = (slug, opts, state, idx) => {\n  const linkTokens = createLink(state, opts.toplinkClass, `#${opts.toplinkName}`,\n    opts.toplinkSymbol)\n\n  addLink(state, opts.toplinkSpace, opts.toplinkBefore, idx, linkTokens)\n}\n\nconst uniqueSlug = (slug, slugs) => {\n  let uniq = slug\n  let i = 2\n  while (hasProp.call(slugs, uniq)) uniq = `${slug}-${i++}`\n  slugs[uniq] = true\n  return uniq\n}\n\nconst isLevelSelectedNumber = selection => level => level >= selection\nconst isLevelSelectedArray = selection => level => selection.includes(level)\n\nconst anchor = (md, opts) => {\n  opts = Object.assign({}, anchor.defaults, opts)\n\n  md.core.ruler.push('anchor', state => {\n    const slugs = {}\n    const tokens = state.tokens\n\n    const isLevelSelected = Array.isArray(opts.level)\n      ? isLevelSelectedArray(opts.level)\n      : isLevelSelectedNumber(opts.level)\n\n    tokens\n      .filter(token => token.type === 'heading_open')\n      .filter(token => isLevelSelected(Number(token.tag.substr(1))))\n      .forEach(token => {\n        // Aggregate the next token children text.\n        const title = tokens[tokens.indexOf(token) + 1]\n          .children\n          .filter(token => token.type === 'text' || token.type === 'code_inline')\n          .reduce((acc, t) => acc + t.content, '')\n\n        let slug = token.attrGet('id')\n\n        if (slug == null) {\n          slug = uniqueSlug(opts.slugify(title), slugs)\n          token.attrPush(['id', slug])\n        }\n\n        if (opts.permalink) {\n          opts.renderPermalink(slug, opts, state, tokens.indexOf(token))\n        }\n\n        if (opts.toplink) {\n          opts.renderToplink(slug, opts, state, tokens.indexOf(token))\n        }\n\n        if (opts.callback) {\n          opts.callback(token, { slug, title })\n        }\n      })\n  })\n}\n\nanchor.defaults = {\n  level: 1,\n  slugify,\n  permalink: false,\n  renderPermalink,\n  permalinkClass: 'header-anchor',\n  permalinkSpace: true,\n  permalinkSymbol: '¶',\n  permalinkBefore: false,\n  permalinkHref,\n  toplink: false,\n  renderToplink,\n  toplinkClass: 'header-toplink',\n  toplinkSpace: true,\n  toplinkSymbol: '↑',\n  toplinkBefore: true,\n  toplinkName: 'top'\n}\n\nexport default anchor\n"],"names":["const","position","false","true","hasProp","Object","prototype","hasOwnProperty","createLink","state","className","href","content","assign","Token","attrs","addLink","withSpace","before","idx","linkTokens","tokens","children","ref","anchor","md","opts","defaults","core","ruler","push","selection","slugs","isLevelSelected","Array","isArray","level","includes","isLevelSelectedNumber","filter","token","type","Number","tag","substr","forEach","title","indexOf","reduce","acc","t","slug","attrGet","uniq","i","call","uniqueSlug","slugify","attrPush","permalink","renderPermalink","toplink","renderToplink","callback","s","encodeURIComponent","String","trim","toLowerCase","replace","permalinkClass","permalinkHref","permalinkSymbol","permalinkSpace","permalinkBefore","toplinkClass","toplinkSymbol","toplinkSpace","toplinkBefore","toplinkName"],"mappings":"AAAAA,IAEMC,EAAW,CACfC,MAAO,OACPC,KAAM,WAGFC,EAAUC,OAAOC,UAAUC,eAI3BC,WAAcC,EAAOC,EAAWC,EAAMC,SACnC,CACLP,OAAOQ,OAAO,IAAIJ,EAAMK,MAAM,YAAa,IAAK,GAAI,CAClDC,MAAO,CACL,CAAC,QAASL,GACV,CAAC,OAAQC,GACT,CAAC,cAAe,WAGpBN,OAAOQ,OAAO,IAAIJ,EAAMK,MAAM,aAAc,GAAI,GAAI,SAAEF,IACtD,IAAIH,EAAMK,MAAM,aAAc,KAAM,KAIlCE,WAAWP,EAAOQ,EAAWC,EAAQC,EAAKC,SAK1CH,GACFG,EAAWnB,GAAUiB,IALHb,OAAOQ,OAAO,IAAIJ,EAAMK,MAAM,OAAQ,GAAI,GAAI,CAAEF,QAAS,UAQ7EH,EAAMY,OAAOF,EAAM,GAAGG,UAASrB,EAASiB,UAASK,EAAGH,IA4BhDI,WAAUC,EAAIC,GAClBA,EAAOrB,OAAOQ,OAAO,GAAIW,EAAOG,SAAUD,GAE1CD,EAAGG,KAAKC,MAAMC,KAAK,kBAAUrB,OALFsB,EAMnBC,EAAQ,GACRX,EAASZ,EAAMY,OAEfY,EAAkBC,MAAMC,QAAQT,EAAKU,QATlBL,EAUAL,EAAKU,eAVQA,UAASL,EAAUM,SAASD,cADxCL,mBAAaK,UAASA,GAASL,GAYrDO,CAAsBZ,EAAKU,OAE/Bf,EACGkB,gBAAOC,SAAwB,iBAAfA,EAAMC,OACtBF,gBAAOC,UAASP,EAAgBS,OAAOF,EAAMG,IAAIC,OAAO,OACxDC,iBAAQL,OAEDM,EAAQzB,EAAOA,EAAO0B,QAAQP,GAAS,GAC1ClB,SACAiB,gBAAOC,SAAwB,SAAfA,EAAMC,MAAkC,gBAAfD,EAAMC,OAC/CO,gBAAQC,EAAKC,UAAMD,EAAMC,EAAEtC,SAAS,IAEnCuC,EAAOX,EAAMY,QAAQ,MAEb,MAARD,IACFA,WAnCUA,EAAMnB,WACpBqB,EAAOF,EACPG,EAAI,EACDlD,EAAQmD,KAAKvB,EAAOqB,IAAOA,EAAQF,MAAUG,WACpDtB,EAAMqB,IAAQ,EACPA,EA8BQG,CAAW9B,EAAK+B,QAAQX,GAAQd,GACvCQ,EAAMkB,SAAS,CAAC,KAAMP,KAGpBzB,EAAKiC,WACPjC,EAAKkC,gBAAgBT,EAAMzB,EAAMjB,EAAOY,EAAO0B,QAAQP,IAGrDd,EAAKmC,SACPnC,EAAKoC,cAAcX,EAAMzB,EAAMjB,EAAOY,EAAO0B,QAAQP,IAGnDd,EAAKqC,UACPrC,EAAKqC,SAASvB,EAAO,MAAEW,QAAML,SAMvCtB,EAAOG,SAAW,CAChBS,MAAO,mBA1GQ4B,UAAMC,mBAAmBC,OAAOF,GAAGG,OAAOC,cAAcC,QAAQ,OAAQ,OA4GvFV,WAAW,2BAvEYR,EAAMzB,EAAMjB,EAAOU,OACpCC,EAAaZ,EAAWC,EAAOiB,EAAK4C,eACxC5C,EAAK6C,cAAcpB,EAAM1C,GAAQiB,EAAK8C,iBAExCxD,EAAQP,EAAOiB,EAAK+C,eAAgB/C,EAAKgD,gBAAiBvD,EAAKC,IAqE/DkD,eAAgB,gBAChBG,gBAAgB,EAChBD,gBAAiB,IACjBE,iBAAiB,yBAxGGvB,aAAYA,GA0GhCU,SAAS,yBAvEYV,EAAMzB,EAAMjB,EAAOU,OAClCC,EAAaZ,EAAWC,EAAOiB,EAAKiD,iBAAkBjD,EAAiB,YAC3EA,EAAKkD,eAEP5D,EAAQP,EAAOiB,EAAKmD,aAAcnD,EAAKoD,cAAe3D,EAAKC,IAqE3DuD,aAAc,iBACdE,cAAc,EACdD,cAAe,IACfE,eAAe,EACfC,YAAa"}